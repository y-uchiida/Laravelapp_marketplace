# ローカルスコープを利用してデータベースアクセス処理をモデルに切り出す
コントローラからModel を読み込んで、クエリビルダやリレーションを利用することができるが、  
複雑なクエリをコントローラに記述するとコードが肥大化する  
また、同じクエリを複数の場所で利用する場合、それぞれにモデルの操作を行うとDRY原則に反する  
そこで、コントローラ側ではなくモデル側でその処理を書く  
このときに利用できる機能を、ローカルスコープという

## ローカルスコープの記述方法
- モデルに、`scopeXXX` という名称のメソッドを創る
- 引数で受け取った変数`$query` を起点として、クエリビルダを記述してreturn する 
- ローカルスコープのあとにもメソッドチェインで別のクエリビルダ関数を使うことができるように、  
  ローカルスコープ内でget() は行わない

## ローカルスコープの記述例
```php
/* User モデルで、ログイン制限されているユーザーだけを取り出す例 */
public function scopeIsLocked($query)
{
    /* User モデルに、 ログイン制限フラグ(freezed)があると仮定 */
    return $query->where('freezed', true);
}
```

## ローカルスコープの利用方法
- モデルのクラスまたはそのモデルのクエリビルダで併用する  
- モデルで宣言したスコープメソッド名の先頭の`scope` はつけない

## ローカルスコープの利用例
```php
$locked_users = User::isLocked()->get();
```
